{% extends 'gerente/base.html' %}

{% block title %}Editar Requisição - ENGEN{% endblock %}

{% block content %}

<div class="adicionar-content">
    <div class="content-header">
        <h2></h2>
        <a href="{% url 'requisicoes' %}" class="btn-secondary">← Voltar</a>
    </div>

    <div class="form-container">
        <div class="form-card">
            <div class="form-header">
                <h3>Requisição #{{ requisicao.id }} - {{ requisicao.cliente.nome }}</h3>
            </div>

            <form method="post" action="{% url 'editar_requisicao' requisicao.id %}">
                {% csrf_token %}
                <div class="form-body">
                    <div class="form-group">
                        <label for="cliente">Cliente <span class="required">*</span></label>
                        <select class="form-control" id="cliente" name="cliente" required>
                            <option value="">Selecione um cliente</option>
                            {% for cliente in clientes %}
                            <option value="{{ cliente.id }}" {% if cliente.id == requisicao.cliente.id %}selected{% endif %}>
                                {{ cliente.nome }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="valor">Valor (MT) <span class="required">*</span></label>
                        <input type="number" class="form-control" id="valor" name="valor" step="0.01" min="0"
                            value="{{ requisicao.valor }}" required>
                    </div>

                    <div class="form-group">
                        <label for="quantidade_senhas">Quantidade de Senhas <span class="required">*</span></label>
                        <input type="number" class="form-control" id="quantidade_senhas" name="quantidade_senhas" min="1"
                            value="{{ requisicao.senhas }}" required>
                        <small class="form-text">Quantidade total de senhas para esta requisição</small>
                    </div>

                    <div class="form-group">
                        <label for="senhas_restantes">Senhas Restantes</label>
                        <input type="number" class="form-control" id="senhas_restantes" name="senhas_restantes" min="0"
                            value="{{ requisicao.senhas_restantes }}">
                        <small class="form-text">Quantidade de senhas ainda disponíveis</small>
                    </div>

                    <div class="form-group">
                        <label for="forma_pagamento">Forma de Pagamento <span class="required">*</span></label>
                        <select class="form-control" id="forma_pagamento" name="forma_pagamento" required onchange="toggleBancoField()">
                            <option value="">Selecione a forma de pagamento</option>
                            <option value="transferencia" {% if requisicao.forma_pagamento == 'transferencia' %}selected{% endif %}>Transferência Bancária</option>
                            <option value="cash" {% if requisicao.forma_pagamento == 'cash' %}selected{% endif %}>Dinheiro (Cash)</option>
                            <option value="pos" {% if requisicao.forma_pagamento == 'pos' %}selected{% endif %}>POS (Cartão)</option>
                        </select>
                    </div>

                    <div class="form-group" id="banco_group" style="display: none;">
                        <label for="banco">Nome do Banco <span class="required">*</span></label>
                        <textarea class="form-control" id="banco" name="banco" rows="2"
                            placeholder="Digite o nome do banco">{{ requisicao.banco|default:'' }}</textarea>
                        <small class="form-text">Obrigatório para transferência bancária</small>
                    </div>

                    <div class="form-group">
                        <label for="observacoes">Observações</label>
                        <textarea class="form-control" id="observacoes" name="observacoes" rows="3"
                            placeholder="Observações sobre a requisição">{{ requisicao.observacoes|default:'' }}</textarea>
                    </div>
                </div>

                <div class="form-footer">
                    <a href="{% url 'requisicoes' %}" class="btn-secondary">Cancelar</a>
                    <button type="submit" class="btn-submit">Atualizar Requisição</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function toggleBancoField() {
    const formaPagamento = document.getElementById('forma_pagamento').value;
    const bancoGroup = document.getElementById('banco_group');
    const bancoField = document.getElementById('banco');

    if (formaPagamento === 'transferencia') {
        bancoGroup.style.display = 'block';
        bancoField.required = true;
    } else {
        bancoGroup.style.display = 'none';
        bancoField.required = false;
        bancoField.value = '';
    }
}

document.addEventListener('DOMContentLoaded', function () {
    toggleBancoField();
    document.getElementById('forma_pagamento').addEventListener('change', toggleBancoField);
});
</script>

{% endblock %}
